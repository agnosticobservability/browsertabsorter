<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="popup.css" />
    <title>Tab Sorter</title>
  </head>
  <body>
    <header class="header">
      <div class="search-box">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input id="tabSearch" type="text" placeholder="Search..." />
      </div>
      <button id="btnUndo" class="icon-btn" title="Undo Last Action">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 7v6h6"></path>
          <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"></path>
        </svg>
      </button>
      <button id="btnSaveState" class="icon-btn" title="Save Current State">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
          <polyline points="17 21 17 13 7 13 7 21"></polyline>
          <polyline points="7 3 7 8 15 8"></polyline>
        </svg>
      </button>
      <button id="btnLoadState" class="icon-btn" title="Load Saved State">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        </svg>
      </button>
      <div style="width: 1px; height: 24px; background: var(--border-color); margin: 0 8px;"></div>
      <button id="btnTheme" class="icon-btn" title="Toggle Theme">
        <svg id="iconMoon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
        <svg id="iconSun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
      <button id="btnSettings" class="icon-btn" title="Settings">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </button>
      <button id="btnPin" class="icon-btn" title="Pin to window">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="17" x2="12" y2="22"></line>
          <path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"></path>
        </svg>
      </button>
      <a href="devtools.html" target="_blank" class="icon-btn" title="DevTools">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="16 18 22 12 16 6"></polyline>
          <polyline points="8 6 2 12 8 18"></polyline>
        </svg>
      </a>
    </header>

    <div class="sort-section">
      <div class="active-strategies-section">
        <div class="section-header">Active Strategies</div>
        <div id="activeStrategiesList" class="strategy-list"></div>
      </div>
      <div class="separator"></div>
      <div class="add-strategy-section">
        <div class="section-header">Add Strategy</div>
        <select id="addStrategySelect" class="strategy-select">
          <option value="" disabled selected>Select Strategy...</option>
        </select>
        <button id="btnApply" class="btn primary full-width">Apply</button>
      </div>
    </div>

    <div class="secondary-actions">
        <button id="btnUngroup" class="btn">Ungroup</button>
        <button id="btnMerge" class="btn">Merge</button>
        <button id="btnSplit" class="btn">Split</button>
    </div>

    <div class="selection-bar">
        <label class="checkbox-label">
          <input type="checkbox" id="selectAll"> Select All
        </label>
        <div class="tree-actions">
            <button id="btnExpandAll" class="text-btn" title="Expand All">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="4 14 12 22 20 14"></polyline>
                <polyline points="4 2 12 10 20 2"></polyline>
              </svg>
            </button>
            <button id="btnCollapseAll" class="text-btn" title="Collapse All">
               <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="18 10 12 2 6 10"></polyline>
                <polyline points="18 22 12 14 6 22"></polyline>
              </svg>
            </button>
        </div>
    </div>

    <dialog id="loadStateDialog">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <h3>Saved States</h3>
        <button id="btnCloseLoadState" style="background: none; border: none; cursor: pointer; color: var(--text-main);">✕</button>
      </div>
      <ul id="savedStateList" style="list-style: none; padding: 0; margin: 0; max-height: 300px; overflow-y: auto;"></ul>
    </dialog>

    <dialog id="settingsDialog">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <h3>Settings</h3>
        <button id="btnCloseSettings" style="background: none; border: none; cursor: pointer; color: var(--text-main);">✕</button>
      </div>
      <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 8px;">Log Level</label>
          <select id="logLevelSelect" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-main);">
              <option value="debug">Debug</option>
              <option value="info">Info</option>
              <option value="warn">Warn</option>
              <option value="error">Error</option>
              <option value="critical">Critical</option>
          </select>
          <small style="color: #888;">Controls the verbosity of logs in the background and popup consoles.</small>
      </div>

      <div style="border-top: 1px solid var(--border-color); margin: 16px 0; padding-top: 16px;">
          <h4 style="margin: 0 0 12px 0;">AI Fallback</h4>

          <div style="margin-bottom: 12px;">
              <label class="checkbox-label">
                  <input type="checkbox" id="aiEnabledCheckbox"> Enable AI Fallback
              </label>
          </div>

          <div id="aiSettingsContainer">
              <div style="margin-bottom: 12px;">
                  <label style="display: block; margin-bottom: 4px; font-size: 0.9em;">Provider</label>
                  <select id="aiProviderSelect" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-main);">
                      <option value="openai">OpenAI</option>
                      <option value="custom">Custom</option>
                  </select>
              </div>

              <div style="margin-bottom: 12px;">
                  <label style="display: block; margin-bottom: 4px; font-size: 0.9em;">API Key</label>
                  <input type="password" id="aiApiKeyInput" placeholder="sk-..." style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-main);">
              </div>

              <div style="margin-bottom: 12px;">
                  <label style="display: block; margin-bottom: 4px; font-size: 0.9em;">Model</label>
                  <input type="text" id="aiModelInput" placeholder="gpt-4o-mini" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-main);">
              </div>

              <div id="aiEndpointContainer" style="margin-bottom: 12px; display: none;">
                  <label style="display: block; margin-bottom: 4px; font-size: 0.9em;">Endpoint URL</label>
                  <input type="text" id="aiEndpointInput" placeholder="https://api.openai.com/v1/chat/completions" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-main);">
              </div>
          </div>
      </div>
    </dialog>

    <main id="windows"></main>

    <footer class="footer">
      <span id="statTabs">0 Tabs</span>
      <span id="statGroups">0 Groups</span>
      <span id="statWindows">0 Windows</span>
    </footer>

    <div id="resizeHandle"></div>

    <div id="progressOverlay" class="overlay hidden">
        <div class="overlay-content">
            <div class="spinner"></div>
            <div id="progressText">Processing...</div>
            <div id="progressCount"></div>
        </div>
    </div>

    <script type="module" src="../build/ui/popup.js"></script>
  </body>
</html>
