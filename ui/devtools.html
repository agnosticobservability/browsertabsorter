<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="devtools.css" />
    <title>Tab Sorter DevTools</title>
  </head>
  <body>
    <header>
      <h1>Tab Sorter Developer Tools</h1>
      <div style="display: flex; gap: 8px; align-items: center;">
        <button id="refreshBtn">Refresh Data</button>
      </div>
    </header>

    <nav class="tabs-nav">
      <button class="tab-btn active" data-target="view-tabs">Tab Data</button>
      <button class="tab-btn" data-target="view-algorithms">Algorithms & Simulation</button>
      <button class="tab-btn" data-target="view-strategies">Strategy Manager</button>
      <button class="tab-btn" data-target="view-strategy-list">Strategy List</button>
      <button class="tab-btn" data-target="view-custom-genera">Custom Genera</button>
    </nav>

    <main>
      <section id="view-tabs" class="view-section active">
        <div id="stats">
          <span>Total Tabs: <span id="totalTabs">0</span></span>
        </div>

        <div class="table-toolbar">
            <div class="search-container">
                <input type="text" id="globalSearch" placeholder="Search all columns..." />
            </div>
            <div class="columns-menu-container">
                <button id="columnsBtn">Columns â–¾</button>
                <div id="columnsMenu" class="columns-menu hidden">
                    <!-- Checkboxes populated by JS -->
                </div>
            </div>
            <button id="resetViewBtn" class="small-btn">Reset View</button>
        </div>

        <div class="table-container">
          <table id="tabsTable">
            <thead>
              <tr id="headerRow">
                <!-- Headers populated by JS to support reordering/resizing -->
              </tr>
              <tr id="filterRow">
                <!-- Filter inputs populated by JS -->
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be populated here -->
            </tbody>
          </table>
        </div>
      </section>

      <section id="view-algorithms" class="view-section">
        <div class="algo-container">

          <div class="algo-card">
            <h2>Grouping & Sorting Simulation</h2>
            <p>Simulate how the current tabs would be organized using different strategies. Drag to reorder.</p>

            <div class="simulation-config">
              <div class="config-section">
                <h3>Grouping Strategies</h3>
                <div class="strategy-list-container" id="sim-grouping-list">
                  <!-- Injected by JS -->
                </div>
              </div>

              <div class="config-section">
                <h3>Sorting Strategies</h3>
                <div class="strategy-list-container" id="sim-sorting-list">
                   <!-- Injected by JS -->
                </div>
              </div>
            </div>

            <div class="action-buttons">
              <button id="runSimBtn">Run Simulation</button>
              <button id="applyBtn" class="success-btn">Apply to Browser</button>
            </div>

            <div id="simResults" class="simulation-results">
              <!-- Results will be injected here -->
              <p style="color: #666; font-style: italic;">Click "Run Simulation" to see results.</p>
            </div>
          </div>

          <div class="algo-card">
            <h2>Strategy Reference</h2>

            <h3>Grouping Strategies</h3>
            <div class="strategy-list" id="grouping-ref">
               <!-- Populated by JS -->
            </div>

            <h3 style="margin-top: 20px;">Sorting Strategies</h3>
            <div class="strategy-list" id="sorting-ref">
               <!-- Populated by JS -->
            </div>

            <h3 style="margin-top: 20px;">Data Registries</h3>
            <div class="strategy-list" id="registry-ref">
               <!-- Populated by JS -->
            </div>
          </div>

        </div>
      </section>

      <section id="view-strategies" class="view-section">
        <div class="algo-container" style="display: flex; flex-direction: row; gap: 20px; width: 100%; height: calc(100vh - 120px); overflow: hidden;">

          <!-- LEFT: Builder -->
          <div class="algo-card" style="flex: 1; min-width: 0; display: flex; flex-direction: column; overflow: hidden;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>Strategy Builder</h2>
                <div>
                   <button id="builder-clear-btn" style="background-color: #f44336; color: white; border: none; padding: 5px 10px; margin-right: 5px; cursor: pointer;">Clear</button>
                   <button id="builder-run-btn">Run</button>
                   <button id="builder-save-btn">Save Strategy</button>
                </div>
            </div>

            <div style="flex: 1; overflow-y: auto; padding-right: 5px;">
                <!-- Header Inputs -->
                <div class="strat-header-grid">
                    <input type="text" id="strat-name" placeholder="Name (e.g. social_workflow)">
                    <input type="text" id="strat-desc" placeholder="Description (e.g. Social Workflow Strategy)">
                    <select id="strategy-load-select">
                      <option value="">Load saved strategy...</option>
                    </select>
                </div>

                <div class="strat-options-row">
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="checkbox" id="strat-autorun"> Auto Run
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="checkbox" id="strat-separate-window"> Move groups to new window
                    </label>
                </div>

                <!-- 1. FILTER -->
                <div class="builder-section">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3>Filter Conditions</h3>
                        <button id="add-filter-group-btn" class="add-row-btn">+ Add Filter Group (OR)</button>
                    </div>
                    <div id="filter-rows-container">
                        <!-- Groups injected here -->
                    </div>
                </div>

                <!-- 2. GROUP -->
                <div class="builder-section">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3>Group Rules</h3>
                        <button id="add-group-btn" class="add-row-btn">Add Group</button>
                    </div>
                    <div id="group-rows-container"></div>

                    <div style="margin-top: 15px; border-top: 1px dashed #ddd; padding-top: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-weight: bold;">
                                <input type="checkbox" id="strat-sortgroups-check"> Group Sorting
                            </label>
                            <button id="add-group-sort-btn" class="add-row-btn" style="display: none; font-size: 0.8em;">Add Sort Rule</button>
                        </div>

                        <div id="group-sort-rows-container" style="display: none; margin-left: 20px; margin-top: 10px; border-left: 2px solid #eee; padding-left: 10px;">
                            <!-- Group Sorting Rules -->
                        </div>
                    </div>
                </div>

                <!-- 3. SORT -->
                <div class="builder-section">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3>Tab Sorting</h3>
                        <button id="add-sort-btn" class="add-row-btn">Add Sort</button>
                    </div>
                    <div id="sort-rows-container"></div>
                </div>

                <!-- Breadcrumb -->
                <div class="breadcrumb-container" style="padding-bottom: 10px;">
                    <p id="strategy-breadcrumb">All ></p>
                </div>
            </div>

          </div>

          <!-- RIGHT: States -->
          <div class="algo-card" style="flex: 1; min-width: 300px; background-color: #fcfcfc; display: flex; flex-direction: column; overflow: hidden;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-shrink: 0;">
                 <h3 style="margin: 0;">Browser State</h3>
                 <button id="refresh-live-view-btn" class="small-btn">Refresh Current</button>
            </div>

            <div id="states-container" style="display: flex; gap: 10px; flex: 1; overflow: hidden;">
                <!-- Current State -->
                <div id="current-state-panel" style="flex: 1; display: flex; flex-direction: column; height: 100%;">
                    <h4 style="margin: 0 0 5px 0; font-size: 1em; color: #555;">Current</h4>
                    <div id="live-view-container" style="flex: 1; overflow-y: auto; border: 1px solid #eee; background: white; padding: 5px; font-family: monospace; font-size: 12px;"></div>
                </div>

                <!-- New State (Hidden initially) -->
                <div id="new-state-panel" style="flex: 1; display: none; flex-direction: column; height: 100%;">
                    <h4 style="margin: 0 0 5px 0; font-size: 1em; color: #007bff;">Simulation</h4>
                    <div id="builder-results" style="flex: 1; overflow-y: auto; border: 1px solid #eee; background: white; padding: 5px; font-family: monospace; font-size: 12px;"></div>
                </div>
            </div>
          </div>

        </div>
      </section>

      <section id="view-strategy-list" class="view-section">
        <div class="algo-container">
          <div class="algo-card">
            <h2>Strategy List</h2>
            <p>Review all built-in and custom strategies.</p>
            <div class="strategy-table-container">
              <table class="strategy-table">
                <thead>
                  <tr>
                    <th>Strategy</th>
                    <th>ID</th>
                    <th>Source</th>
                    <th>Capabilities</th>
                    <th>Configuration</th>
                    <th>Auto Run</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="strategy-table-body">
                  <!-- Populated by JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section id="view-custom-genera" class="view-section">
        <div class="algo-container">
          <div class="algo-card">
            <h2>Custom Genera</h2>
            <p>Map specific domains to categories.</p>
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
              <input type="text" id="new-genera-domain" placeholder="Domain (e.g. example.com)" style="flex: 1; padding: 5px;">
              <input type="text" id="new-genera-category" placeholder="Category (e.g. Work)" style="flex: 1; padding: 5px;">
              <button id="add-genera-btn" style="padding: 5px 15px;">Add</button>
            </div>
            <div id="custom-genera-list" style="max-height: 400px; overflow-y: auto;">
              <!-- Custom entries populated by JS -->
            </div>
          </div>
        </div>
      </section>
    </main>

    <script type="module" src="../dist/ui/devtools.js"></script>
  </body>
</html>
