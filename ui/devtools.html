<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="devtools.css" />
    <title>Tab Sorter DevTools</title>
  </head>
  <body>
    <header>
      <h1>Tab Sorter Developer Tools</h1>
      <div style="display: flex; gap: 8px; align-items: center;">
        <button id="refreshBtn">Refresh Data</button>
      </div>
    </header>

    <nav class="tabs-nav">
      <button class="tab-btn active" data-target="view-tabs">Tab Data</button>
      <button class="tab-btn" data-target="view-algorithms">Algorithms & Simulation</button>
      <button class="tab-btn" data-target="view-strategies">Strategy Manager</button>
    </nav>

    <main>
      <section id="view-tabs" class="view-section active">
        <div id="stats">
          <span>Total Tabs: <span id="totalTabs">0</span></span>
        </div>

        <div class="table-toolbar">
            <div class="search-container">
                <input type="text" id="globalSearch" placeholder="Search all columns..." />
            </div>
            <div class="columns-menu-container">
                <button id="columnsBtn">Columns â–¾</button>
                <div id="columnsMenu" class="columns-menu hidden">
                    <!-- Checkboxes populated by JS -->
                </div>
            </div>
            <button id="resetViewBtn" class="small-btn">Reset View</button>
        </div>

        <div class="table-container">
          <table id="tabsTable">
            <thead>
              <tr id="headerRow">
                <!-- Headers populated by JS to support reordering/resizing -->
              </tr>
              <tr id="filterRow">
                <!-- Filter inputs populated by JS -->
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be populated here -->
            </tbody>
          </table>
        </div>
      </section>

      <section id="view-algorithms" class="view-section">
        <div class="algo-container">

          <div class="algo-card">
            <h2>Grouping & Sorting Simulation</h2>
            <p>Simulate how the current tabs would be organized using different strategies. Drag to reorder.</p>

            <div class="simulation-config">
              <div class="config-section">
                <h3>Grouping Strategies</h3>
                <div class="strategy-list-container" id="sim-grouping-list">
                  <!-- Injected by JS -->
                </div>
              </div>

              <div class="config-section">
                <h3>Sorting Strategies</h3>
                <div class="strategy-list-container" id="sim-sorting-list">
                   <!-- Injected by JS -->
                </div>
              </div>
            </div>

            <div class="action-buttons">
              <button id="runSimBtn">Run Simulation</button>
              <button id="applyBtn" class="success-btn">Apply to Browser</button>
            </div>

            <div id="simResults" class="simulation-results">
              <!-- Results will be injected here -->
              <p style="color: #666; font-style: italic;">Click "Run Simulation" to see results.</p>
            </div>
          </div>

          <div class="algo-card">
            <h2>Strategy Reference</h2>

            <h3>Grouping Strategies</h3>
            <div class="strategy-list" id="grouping-ref">
               <!-- Populated by JS -->
            </div>

            <h3 style="margin-top: 20px;">Sorting Strategies</h3>
            <div class="strategy-list" id="sorting-ref">
               <!-- Populated by JS -->
            </div>

            <h3 style="margin-top: 20px;">Data Registries</h3>
            <div class="strategy-list" id="registry-ref">
               <!-- Populated by JS -->
            </div>
          </div>

        </div>
      </section>

      <section id="view-strategies" class="view-section">
        <div class="algo-container">
          <div class="algo-card" style="width: 100%;">
            <h2>Strategy Manager</h2>

            <div id="custom-strategies-container">
              <div class="strategy-builder-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0;">Tab Sorter Strategy Builder</h3>
                <div style="display: flex; gap: 8px;">
                  <input type="text" id="new-strat-id" placeholder="ID (e.g. social)" style="width: 120px; padding: 5px;">
                  <input type="text" id="new-strat-label" placeholder="Label (e.g. Social)" style="width: 150px; padding: 5px;">
                  <input type="text" id="new-strat-fallback" placeholder="Fallback (Optional)" style="width: 120px; padding: 5px;">
                  <button id="run-builder-btn" style="padding: 5px 15px;">Run</button>
                  <button id="save-strat-btn" style="padding: 5px 15px; background: #007bff; color: white; border: none; border-radius: 4px;">Save Strategy</button>
                </div>
              </div>

              <!-- Conditions Section -->
              <div class="builder-section" style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: #fdfdfd; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                  <h4 style="margin: 0;">All of these conditions must be met (Rules)</h4>
                  <div style="display: flex; gap: 5px;">
                     <button id="add-group-btn" class="small-btn">+ Add Rule Group</button>
                  </div>
                </div>

                <div id="rules-list">
                    <!-- Rule Rows Injected Here -->
                </div>
              </div>

              <!-- Sorting Section -->
              <div class="builder-section" style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: #fdfdfd; margin-bottom: 20px;">
                <h4 style="margin-top: 0;">Order results by the following fields</h4>
                <div id="sort-list">
                    <!-- Sort Rows Injected Here -->
                </div>
                <button id="add-sort-btn" class="small-btn" style="margin-top: 5px;">+ Add Sort</button>
              </div>

              <!-- Simulation Results Preview -->
              <div id="builder-results-container" style="border-top: 2px solid #eee; padding-top: 20px; margin-top: 20px;">
                 <h4>Simulation Results</h4>
                 <div id="builder-results-table-container">
                    <table id="builderResultsTable" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <thead>
                            <tr style="background: #f5f5f5; text-align: left;">
                                <th style="padding: 5px;">#</th>
                                <th style="padding: 5px;">Title</th>
                                <th style="padding: 5px;">URL</th>
                                <th style="padding: 5px;">Domain</th>
                                <th style="padding: 5px;">Group</th>
                                <th style="padding: 5px;">Sort Order</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Results -->
                        </tbody>
                    </table>
                 </div>
              </div>

              <h4 style="margin-top: 30px;">Existing Strategies</h4>
              <div id="custom-strategies-list" style="max-height: 300px; overflow-y: auto;">
                  <!-- All strategies populated by JS -->
              </div>
            </div>

            <div id="custom-genera-container" style="margin-top: 40px; border-top: 1px solid #eee; padding-top: 15px;">
              <h3>Custom Genera</h3>
              <p>Map specific domains to categories.</p>
              <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <input type="text" id="new-genera-domain" placeholder="Domain (e.g. example.com)" style="flex: 1; padding: 5px;">
                <input type="text" id="new-genera-category" placeholder="Category (e.g. Work)" style="flex: 1; padding: 5px;">
                <button id="add-genera-btn" style="padding: 5px 15px;">Add</button>
              </div>
              <div id="custom-genera-list" style="max-height: 200px; overflow-y: auto;">
                <!-- Custom entries populated by JS -->
              </div>
            </div>

          </div>
        </div>
      </section>
    </main>

    <script type="module" src="../dist/ui/devtools.js"></script>
  </body>
</html>
